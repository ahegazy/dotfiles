#!/bin/bash

showRunning(){
    country=`echo $status | grep  -o 'Country: [[:alnum:]]*'`
    ip=`echo $status | grep -oE 'IP: ([[:digit:]]{1,}\.*)*'`
   exec i3-nagbar -t warning -m "NordVPN is connected, $country, $ip" -B "stop service" "nordvpn disconnect;sudo /usr/bin/systemctl stop nordvpnd && killall -1 i3-nagbar" -B "status" "termite --hold -e 'nordvpn status'" 
    
}
status=`nordvpn status`

if [[ -z `echo $status | grep "Disconnected"` && -z `echo $status | grep "Whoops!"` ]]
then
    showRunning   
else
    sudo /usr/bin/systemctl start nordvpnd

    nordvpn set technology nordlynx
    
    #nordvpn set technology openvpn
    #nordvpn set obfuscate on
    nordvpn connect

    status=`nordvpn status`
    if [[ -z `echo $status | grep "Disconnected"` ]]
    then
        showRunning
    else
        exec i3-nagbar -t error -m "nordvpn is not connected"
    fi
fi
#sudo /usr/bin/systemctl stop nordvpnd
